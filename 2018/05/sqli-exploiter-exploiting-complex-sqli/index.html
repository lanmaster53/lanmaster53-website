<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>lanmaster53.com</title>
        <meta name="author" content="Tim Tomes">
        <meta name="description" content="Articles, information, and projects related to development and web application security.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:400,300,600" type="text/css">
        <link rel="stylesheet" href="/static/css/normalize.css">
        <link rel="stylesheet" href="/static/css/skeleton.css">
        <link rel="stylesheet" href="/static/css/style.css">
        <link rel="stylesheet" href="/static/css/pygments.css">
        <link rel="shortcut icon" href="https://www.gravatar.com/avatar/0a6d9b1ad59ad436bf9d9d16b2a7133e.png?s=16" />
    </head>
    <body>
        <div class="container">
            <div class="row">
                <div class="four columns meta">
                    <ul>
                        <li><a href="/"><img src="https://www.gravatar.com/avatar/0a6d9b1ad59ad436bf9d9d16b2a7133e.png?s=128" class="avatar" /></a></li>
                                            <li><a href="https://bitbucket.org/lanmaster53" target="_blank"><img src="/static/images/meta/bitbucket.png" /></a></li>
                                            <li><a href="https://github.com/lanmaster53" target="_blank"><img src="/static/images/meta/github.png" /></a></li>
                                            <li><a href="https://twitter.com/lanmaster53" target="_blank"><img src="/static/images/meta/twitter.png" /></a></li>
                                            <li><a href="https://www.linkedin.com/in/lanmaster53" target="_blank"><img src="/static/images/meta/linkedin.png" /></a></li>
                                            <li><a href="https://www.youtube.com/user/lanmaster53" target="_blank"><img src="/static/images/meta/youtube.png" /></a></li>
                                        </ul>
                </div>
                <div class="eight columns nav">
                    <ul>
                        <li><a href="https://www.practisec.com/"><span style="font-weight: bold; color: #00b5ef;">Practi</span><span style="font-weight: bold; color: #1e1b1d;">Sec</span></a> | </li>
                                            <li><a href="/projects/">Projects</a> | </li>
                                            <li><a href="/archive/">Archive</a> | </li>
                                            <li><a href="/categories/">Categories</a> | </li>
                                            <li><a href="/about/">About</a></li>
                                        </ul>
                </div>
            </div>
            <!-- hr style="margin-top: 0;" -->
            <div class="row">
                <div class="twelve columns">
                    <h2>SQLi Exploiter: Exploiting Complex SQL Injections</h2>
<h5>Thursday, May 24, 2018</h5>
                </div>
            </div>
            <hr>
            <div class="row">
                <div class="twelve columns">
                    <div class="content">
    <p>Raise your hand if you've ever had sqlmap fail to find or exploit a vulnerability you knew to exist? I imagine there's a lot of folks with their hands up right now. Okay, put your hands down.</p>
<!-- READMORE -->

<p>I'll be the first person to tell you that sqlmap can almost always be tuned to discover a SQL injection vulnerability found through other means. I'll also be the first to recommend never using sqlmap to discover new SQL injection vulnerabilities. While discovering SQL injection vulnerabilities is not a strength of sqlmap, it is without a doubt the king of exploiting them. The trick is, sqlmap has to discover the vulnerability before it can exploit it. So if it can't discover it, it can't exploit it... you know where I'm going with this. The bottom line is, there is only so much you can do with command line switches and sometimes you run into edge cases where sqlmap just doesn't get it. Hence, the reason for this blog article.</p>
<p>I was on a test recently where I discovered a timing-based blind injection vulnerability in an <code>ORDER BY</code> clause that prevented the use of single quotes. I searched the vast sqlmap help file, explored the tamper scripts, and spent several hours trying to get sqlmap to discover the vulnerability I had found. The developer of sqlmap could probably have configured sqlmap to find it, but I could not. I can honestly say this was the first time this has happened to me. I've talked to many people that say it happens all the time, but I'd be willing to bet it was a result of them not knowing the sqlmap configuration options or the vulnerablity well enough to tell sqlmap how to find it. But I digress. Sqlmap wasn't doing it for me this time.</p>
<p>So I decided to use Burp Intruder. If you've never done blind SQL injection enumeration with Intruder before, it's actualy quite fun. You create insertion points for each part of the query that needs to be enumerated, then you create the associated payload sets and run the attack. Sorting by various columns depending on the vulnerabilty will allow you to determine what was enumerated by the attack. The biggest problem with this approach is that Intruder isn't smart enough to stop enumerating when a successful character is enumerated from one of the payload sets. Therefore, it has to continue all of the other payloads in the set, which at this point we know are going to fail. When the vulnerability is timing-based, this can result in extended wait times. Also, it's extremely noisy from a monitoring perspective. In this case, the timing condition was any response that took longer than two seconds to respond. Start doing the math. Yeah.</p>
<p>I've built my career on finding gaps and filling them. The space between Intruder and sqlmap with regards to exploiting complex SQL injections is space worth filling. So I built something.</p>
<p><a href="https://github.com/lanmaster53/sqli-exploiter">https://github.com/lanmaster53/sqli-exploiter</a></p>
<p>Be warned, this is not a script kiddie tool. Usage requires detailed knowledge of the vulnerability, a thorough understand of the functionality available in the affected RDBMS, and the ability to write Python. However, the good news is that it is highly configurable as a result. I can't imagine an injection scenario that it can't be configured to exploit. Give it a shot and let me know what you think.</p>
</div>
<p>Like what you see? Join me for live training! See the <a href="https://www.practisec.com/training/">Training</a> page for more information.</p>
<hr>
<div class="comments">
    <h6>Please share your thoughts, comments, and suggestions via Twitter.</h6>
    <a href="http://twitter.com/share" class="twitter-share-button" data-count="none" data-via="">Tweet</a>
    <a href="http://twitter.com/lanmaster53" class="twitter-follow-button" data-show-count="false">Follow @lanmaster53</a>
    <script src="https://platform.twitter.com/widgets.js" type="text/javascript"></script>
</div>
                </div>
            </div>
            <hr>
            <div class="row">
                <div class="twelve columns">
                    <footer>
                        <p style="float: right;">
                            &copy; 2022 Tim Tomes
                        </p>
                    </footer>
                </div>
            </div>
        </div>
        <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-52269615-1', 'lanmaster53.com');
    ga('send', 'pageview');
</script>    </body>
</html>